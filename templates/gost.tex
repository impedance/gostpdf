% gost.tex — шаблон ROSA ГОСТ для Pandoc

\documentclass[$fonts.base_size$]{$document.class$}

% ========= Базовые пакеты =========
\usepackage{ifxetex,ifluatex}
\usepackage{ifthen}
\usepackage{calc}
\usepackage{polyglossia}
$if(document.lang)$
  \setmainlanguage{$document.lang$}
$else$
  \setmainlanguage{russian}
$endif$
  \setotherlanguage{english}

\usepackage{fontspec}
\setmainfont{$fonts.main$}
\setsansfont{$fonts.main$}
\setmonofont{$fonts.mono$}

\usepackage{geometry}
\geometry{
  paper=$page.size$,
  left=$page.margins.left$,
  right=$page.margins.right$,
  top=$page.margins.top$,
  bottom=$page.margins.bottom$
}

\usepackage{setspace}
\setstretch{$fonts.line_height$}
\clubpenalty=10000
\widowpenalty=10000
\displaywidowpenalty=10000

\usepackage{microtype}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage{tocloft}
\usepackage{hyperref}
\hypersetup{
  unicode=true,
  colorlinks=false,
  pdfborder={0 0 0},
  pdftitle={$title$},
  pdfauthor={$author$}
}

\usepackage{graphicx}
\usepackage{caption}
\usepackage{array}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{listings}

% ========= Параграфы =========
\setlength{\parindent}{$paragraph.indent_first_line$}
\setlength{\parskip}{$paragraph.spacing.after$}

% ========= Колонтитулы =========
\pagestyle{fancy}
\fancyhf{}
\fancyhead[C]{$if(header.center)$$header.center$$endif$}
\fancyfoot[C]{\thepage}

% ========= Заголовки =========
% H1 — все прописные, по центру, с новой страницы
\titleformat{\section}
  {\bfseries\fontsize{$fonts.h1_size$}{$fonts.h1_baseline$}\selectfont}
  {\thesection}{1em}{\clearpage\centering\MakeUppercase}
\titlespacing*{\section}{0pt}{30pt}{18pt}

% H2
\titleformat{\subsection}
  {\normalfont\fontsize{$fonts.h2_size$}{$fonts.h2_baseline$}\selectfont}
  {\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{24pt}{12pt}

% H3
\titleformat{\subsubsection}
  {\bfseries\fontsize{$fonts.h3_size$}{$fonts.h3_baseline$}\selectfont}
  {\thesubsubsection}{1em}{}
\titlespacing*{\subsubsection}{0pt}{18pt}{12pt}

% H4–H6 можно при желании донастроить аналогично

% ========= Списки =========
% Нумерованный список с русскими буквами: а), б), в) …
\AddEnumerateCounter{\asbuk}{\russian@alph}{щ}
\setlist[enumerate,1]{
  label=\asbuk*),
  leftmargin=$lists.ordered.indent$,
  itemindent=0pt,
  labelsep=0.5em,
  topsep=0pt,
  parsep=0pt,
  itemsep=$lists.ordered.spacing_after$
}

% Вложенные списки с маркером "—", отступ 1.85 см
\setlist[itemize,1]{
  label=---,
  leftmargin=$lists.nested.left_indent$,
  itemindent=0pt,
  topsep=0pt,
  parsep=0pt,
  itemsep=$lists.nested.spacing_after$
}

% ========= Таблицы и подписи =========
\captionsetup[table]{
  font=normalsize,
  justification=raggedright,
  singlelinecheck=false,
  margin=$tables.caption_indent$,
  indention=$tables.caption_indent$,
  aboveskip=$tables.spacing.before_caption$,
  belowskip=$tables.spacing.after_caption$
}
\captionsetup[figure]{
  font=normalsize,
  justification=raggedright,
  singlelinecheck=false,
  margin=$figures.caption_indent$,
  indention=$figures.caption_indent$,
  aboveskip=$figures.spacing.before$,
  belowskip=$figures.spacing.after$
}

% Формат подписей "Таблица N – ..." и "Рисунок N – ..."
\renewcommand{\tablename}{Таблица}
\renewcommand{\figurename}{Рисунок}
\renewcommand{\thetable}{\arabic{table}}
\renewcommand{\thefigure}{\arabic{figure}}
\DeclareCaptionLabelFormat{dash}{#1~#2~--}
\captionsetup[table]{labelformat=dash}
\captionsetup[figure]{labelformat=dash}

% ========= Области кода =========
\lstset{
  basicstyle=\ttfamily\fontsize{$codeblock.font_size$}{$codeblock.baseline$}\selectfont,
  columns=fullflexible,
  keepspaces=true,
  showstringspaces=false,
  breaklines=true,
  frame=$codeblock.frame$,
  xleftmargin=$codeblock.left_indent$,
  aboveskip=$codeblock.spacing_after$,
  belowskip=$codeblock.spacing_after$
}

% Pandoc будет использовать lstlisting для блоков кода
$if(listings)$
$endif$

% ========= Примечания =========
% Простой макрос для примечания, слово "П р и м е ч а н и е" разреженное.
\newcommand{\NoteLabel}{\textls[$notes.label_letterspacing$]{$notes.label$}}
\newenvironment{rosanote}
  {\par\noindent\textbf{\NoteLabel{} —}\ }
  {\par}

% ========= Табличный текст =========
\renewcommand{\arraystretch}{$tables.cell.line_height$}
\AtBeginEnvironment{tabular}{\setlength{\parindent}{$tables.cell.first_line_indent$}\setlength{\parskip}{$tables.cell.spacing_after$}}
\AtBeginEnvironment{longtable}{\setlength{\parindent}{$tables.cell.first_line_indent$}\setlength{\parskip}{$tables.cell.spacing_after$}}

% ========= Кнопки / клавиши =========
\newcommand{\key}[1]{\texttt{\fontsize{$button.font_size$}{$button.baseline$}\selectfont #1}}

% ========= Титульный лист =========
\newcommand{\makemytitle}{
  \begin{titlepage}
    \centering
    \vspace*{$titlepage.logo_top_skip$}
    $if(logo)$
      \includegraphics[width=$titlepage.logo_width$]{${logo}$}\par
      \vspace{20mm}
    $endif$
    $if(titlepage.org)$
      {\fontsize{$titlepage.org_font_size$}{$titlepage.org_font_size$}\selectfont $titlepage.org$ \par}
      \vspace{10mm}
    $endif$
    {\fontsize{$titlepage.product_font_size$}{$titlepage.product_font_size$}\selectfont$if(titlepage.product_bold)$\bfseries$endif$ $title$ \par}
    \vspace{15mm}
    {\fontsize{$titlepage.doc_type_font_size$}{$titlepage.doc_type_font_size$}\selectfont $doctype$ \par}
    $if(titlepage.index)$
      \vspace{10mm}
      {\fontsize{$titlepage.index_font_size$}{$titlepage.index_font_size$}\selectfont $titlepage.index$ \par}
    $endif$
    \vfill
    {\fontsize{$titlepage.year_font_size$}{$titlepage.year_font_size$}\selectfont $date$ \par}
  \end{titlepage}
}

% ========= Оглавление =========
\renewcommand{\contentsname}{$if(toc.title)$$toc.title$$else$СОДЕРЖАНИЕ$endif$}
\setlength{\cftbeforetoctitleskip}{30pt}
\setlength{\cftaftertoctitleskip}{18pt}
\setlength{\cftparskip}{0pt}
\setlength{\cftbeforesecskip}{0pt}

% ========= Начало документа =========
\begin{document}

$if(document.titlepage)$
  \makemytitle
$endif$

$if(toc)$
{
  \pagestyle{plain}
  \tableofcontents
  \clearpage
}
$endif$

$body$

\end{document}
