# Типовые ошибки и способы их устранения

В таблице 12 приведен перечень типовых ошибок и способов их устранения в процессе эксплуатации Комплекса.

::app-collapsible
---
label: "Таблица 12 - Типовые ошибки"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Сообщение об ошибке</th>
      <th>Действия администратора</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>При выполнении puppet-agent на клиентском АРМ или сервере puppet:</em><br>Error: /File[/var/lib/puppet/facts.d]: Could not evaluate: Could not retrieve information from environment $yourenvironment source(s) puppet://localhost/pluginfacts</td>
      <td>На сервере Комплекса<em> </em>создать папку   в каталоге модуля</td>
    </tr>
    <tr>
      <td><em>При выполнении puppet-agent на клиентском АРМ или сервере puppet:</em><br>Error: Could not retrieve catalog from remote server: Error 400 on SERVER: Failed when searching for node $nodename: No such file or directory @ dir_s_rmdir – /etc/puppetlabs/hiera/node/$nodename.yaml20150812-5415-1802nxn.lock.</td>
      <td>На сервере Комплекса<em> </em>выполнить в терминале команду:<br>chown -R puppet:puppet /etc/puppetlabs/puppet/</td>
    </tr>
    <tr>
      <td><em>При выполнении puppet-agent на клиентском АРМ или сервере puppet:</em><br>SSL_connect returned=1 errno=0 state=SSLv3 read server session ticket A: sslv3 alert certificate revoked.</td>
      <td rowspan="2">На клиентском АРМ выполнить в терминале команду:<br>sudo rm -r /etc/puppetlabs/puppet/ssl<br>На сервере Комплекса удалить сертификат проблемного узла.</td>
    </tr>
    <tr>
      <td><em>При выполнении puppet-agent на клиентском АРМ или сервере puppet:</em><br>Wrapped exception:<br>SSL_connect returned=1 errno=0 state=unknown state: certificate verify failed: [self signed certificate in certificate chain for /CN=Puppet CA: puppetmaster.example.com].</td>
    </tr>
    <tr>
      <td><em>При выполнении puppet-agent на клиентском АРМ или сервере puppet:</em><br>ERF12-0104 Общие ошибки подключения или SSL-соединения.</td>
      <td>На сервере Комплекса:<br>– если полагаться на групповую запись, то нужно убедиться, что foreman-proxy является членом группы puppet, и перезапустить foreman-proxy;<br>– может потребоваться добавление строки в puppet.conf, чтобы убедиться, что она остается 0664:<br>autosign = $ confdir / autosign.conf {mode = 664}</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF12-0735 Невозможно удалить запись DHCP для% s</td>
      <td rowspan="3">В веб-интерфейсе Комплекса:<br>– убедиться, что следующие настройки (&quot;Управление → Параметры → Аутентификация&quot;) правильно установлены на экземпляре Комплекса: Сертификат SSL, Файл центр сертификации SSL, Закрытый ключ SSL;<br>– убедиться, что имя узла прокси совпадает с тем, для которого был выдан сертификат (Общее имя), и, что время синхронизировано с NTP на обоих серверах.<br>– если в соединении отказано, то это значит, что Комплекс пытается открыть HTTP-соединение с прокси-сервером (обычно через порт 8443).<br>1)Сначала проверить, что прокси действительно запущен:<br># service foreman-proxy status foreman-proxy (pid 10025) is running ...<br>2)Проверить наличие запрещающих правил межсетевых экранов между Комплексом и прокси-узлом, включая iptables или аналогичные, работающие на самом прокси;<br>3) Попробовать выполнить тестовое подключение от сервера Комплекса к прокси, например,<br>telnet proxy.example.com 8443.<br>[Errno :: ECONNRESET]: сброс соединения одноранговым узлом обычно указывает, что интеллектуальный прокси-сервер работает по одному протоколу (например, HTTPS), а Комплекс пытается использовать другой (например, HTTP);<br>4) Отредактировать смарт-прокси через интерфейс Комплекса и изменить протокол в поле URL. Если параметры ssl_ * в /etc/foreman-proxy/settings.yml раскомментированы, то прокси – HTTPS, поэтому URL-адрес должен начинаться с &quot;https://&quot;.<br>[RestClient :: ResourceNotFound]: 404 Resource Not Found. – это может зависеть от контекста (прокси может возвращать 404, потому что некоторая запись не найдена), но может означать, что функция, которая, как ожидается, будет доступна на прокси (например, Puppet, DNS) фактически не включена в файле конфигурации или запущенном экземпляре.<br>[RestClient :: RequestTimeout]: Тайм-аут запроса. – в этом случае нужно убедиться, что сервер Комплекса имеет сетевой доступ к интеллектуальному прокси-серверу:<br>1) Попробовать использовать команды &quot;telnet proxy.example.com 8443&quot; или &quot;curl -k https://proxy.example.com:8443/features&quot;.<br>2) Проверить журналы. В /etc/foreman-proxy/settings.yml можно найти путь к файлу журнала прокси-сервера, обычно это: /var/log/foreman-proxy/proxy.log</td>
    </tr>
    <tr>
      <td><em>В веб-интерфей</em>се Комплекса:<br>ERF12-0735 Невозможно удалить запись DHCP. Общие ошибки подключения или SSL-соединения.</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе </em>Комплекса<em>:</em><br>ERF12-2357 Невозможно установить запись DNS.</td>
    </tr>
    <tr>
      <td><em>На сервере Комплекса:</em><br>ERF12-4115 Общие ошибки или ошибки SSL-соединения.</td>
      <td>На сервере Комплекса<em> </em>убедиться, что для всех файлов и родительских каталогов установлены достаточные права (например, чтение / выполнение).</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-1994 Невозможно найти правильный метод аутентификации.</td>
      <td>В веб-интерфейсе Комплекса необходимо задать пароль, т.к., если получена эта ошибка, вероятно, что пароль отсутствует в определении пользовательского интерфейса Комплекса</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-3305 Невозможно найти шаблон ...</td>
      <td>На сервере Комплекса<em> </em>проверить правильность с помощью &quot;ls -l PATH&quot; и, возможно, потребуется обновить представления, доступные в libvirt, с помощью &quot;virsh pool-refresh&quot;</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-4505 Недопустимый путь.</td>
      <td>В веб-интерфейсе Комплекса<em> </em>проверить параметр Default_variables_Lookup_Path в разделе &quot;Дополнительно → Настройки → Puppet&quot;. Он должен быть определен как массив (например, [домен ОС группы узлов fqdn]). Если он определен с помощью начального скрипта, то надо убедиться, что он сохранен как массив, а не как строка</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-4516 В методе отсутствуют необходимые параметры для перенаправления.</td>
      <td>На сервере Комплекса<em> </em>это говорит об ошибке разработки, например, указано process_success вместо process_success: success_redirect =&gt; host_path (@host): redirect_xhr =&gt; request.xhr?</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-7495 &quot;Не удается найти пользователя foreman_admin при переключении контекста&quot; или &quot;Не удается найти пользователя foreman_api_admin при переключении контекста&quot;.</td>
      <td>На сервере Комплекса<em> </em>восстановить пользователей, запустив в терминале команду:<br>Foreman-rake db: seed</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-9958 &quot;Неизвестная поддержка управления питанием – невозможно продолжить&quot;.</td>
      <td>На сервере Комплекса<em> </em>отредактировать узел и создать новый сетевой интерфейс BMC, который должен указывать на интерфейс управления на узле с правильным IP-адресом и учетными данными. Требуется интеллектуальный прокси с включенной функцией BMC – это служба, с которой Комплекс свяжется для выполнения команд IPMI</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-9972 Невозможно создать конфигурацию LDAP для ...</td>
      <td>На сервере Комплекса достаточно создать служебную учетную запись с правами поиска и чтения записей пользователей и групп. Изменить учетные данные нужно в разделе &quot;Управление → Параметры → Аутентификация&quot;</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF50-1006 Невозможно подключиться к серверу LDAP</td>
      <td>На сервере Комплекса<em> </em>убедиться, что сертификат TLS для сервера LDAPS действителен и соответствует имени узла сервера</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF50-5345 Убедитесь, что SSL включен в foreman-proxy:: enabled: https</td>
      <td>В веб-интерфейсе Комплекса<em> </em>убедиться, что SSL включен в Комплексе:<br>proxy:: enabled: https</td>
    </tr>
    <tr>
      <td><em>В веб-интерфейсе Комплекса:</em><br>ERF42-9666: для загрузки HTTP требуется прокси с функцией httpboot, а выставленная настройка http_port</td>
      <td>На сервере Комплекса существует расширенный параметр, который по умолчанию скрыт и включен. Нужно проверить, не был ли он отключен по ошибке:<br>foreman-installer \ --foreman-proxy-http true \ --foreman-proxy-https true \ --foreman-proxy-httpboot true \ --foreman-proxy-tftp true</td>
    </tr>
    <tr>
      <td><em>В журнале ошибок сервиса dynflow-sidekiq (запрашивается выводом команды journalctl -fu dynflow-sidekiq@worker.service) появляются сообщения вида:</em><br>dynflow-sidekiq@worker[36703]: 2022-01-17T11:22:57.078Z 36703 TID-gpkfjfkoj ERROR: Heartbeat thread error: Connection lost (ECONNRESET)<br>При этом наблюдается замедление работы веб-интерфейса</td>
      <td>На сервере Комплекса:<br>– отключить сервис network threat protection для Kaspersky Endpoint Security for Linux (KESL);<br>– перезапустить службы foreman и puppetserver</td>
    </tr>
  </tbody>
</table>
::

