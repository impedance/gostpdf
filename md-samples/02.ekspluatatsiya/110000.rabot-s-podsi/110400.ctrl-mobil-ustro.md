# Управление мобильными устройствами

Начиная с версии 2.2, РОСА Центр Управления поддерживает интеграцию с мобильными устройствами (далее – МУ) на ОС "РОСА Мобайл". Функционал управления МУ предоставляется в формате отдельного образа установочного диска (дистрибутива).

Реализованные классы Puppet функций и фактов описаны в пп. Управление пакетной базой-Получение информации о текущем состоянии:

- автоматизированное подключение к серверу Комплекса;
- управление пакетной базой МУ (установка, обновление и удаление ПО);
- настройка интервала синхронизации МУ;
- управление блокировкой камеры МУ;
- управление ПИН-кодом, блокировка МУ;
- удаление пользовательских данных;
- сброс настроек МУ до заводских;
- управление работой GPS-приемника;
- управление работой GSM-модема;
- получение информации о местоположении МУ по данным системы глобального позиционирования;
- получение информации о ближайших Wi-Fi-сетях;
- получение информации об используемом GSM-соединении;
- получение информации о списке установленных пакетов и их версиях;
- получении информации о состоянии заряда аккумулятора МУ.

Описание интеграции РОСА Центр Управления с МУ приведено в п. 3.4 документа "РОСА Центр Управления. Руководство системного администратора. Часть 2. Эксплуатация " (шифр РСЮК.10121-09 32 02).

## Управление пакетной базой

Модуль управления пакетной базой предназначен для централизованной установки, обновления или удаления пакета (или их перечня) на конечном МУ. Параметры класса приведены в таблице 4.

::app-collapsible
---
label: "Таблица 4 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_package_manager</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>pkgs_to_install</td>
      <td>массив</td>
      <td>[&quot;app1&quot;,&quot;app2&quot;]</td>
      <td>Перечень пакетов для установки</td>
    </tr>
    <tr>
      <td></td>
      <td>pkgs_to_remove</td>
      <td>массив</td>
      <td>[&quot;app3&quot;,&quot;app4&quot;]</td>
      <td>Перечень пакетов для удаления</td>
    </tr>
    <tr>
      <td></td>
      <td>pkgs_to_update</td>
      <td>массив</td>
      <td>[&quot;app5&quot;,&quot;app6&quot;]</td>
      <td>Перечень пакетов для обновления</td>
    </tr>
  </tbody>
</table>
::

## Настройка интервала синхронизации

Модуль управления интервалом синхронизации предназначен для централизованной настройки частоты обращения клиентского МУ к серверу Комплекса. Использование параметров rand_min и rand_max позволяет настроить минимальную и максимальную границы произвольного приращения к задаваемому параметру во избежание пиковых нагрузок. Параметры класса приведены в таблице 5.

::app-collapsible
---
label: "Таблица 5 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_runinterval</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>runinteval</td>
      <td>целое число</td>
      <td>15</td>
      <td>Частота синхронизации в минутах</td>
    </tr>
    <tr>
      <td></td>
      <td>rand_min</td>
      <td>целое число</td>
      <td>0</td>
      <td>Минимальное приращение в минутах</td>
    </tr>
    <tr>
      <td></td>
      <td>rand_max</td>
      <td>целое число</td>
      <td>4</td>
      <td>Максимальное приращение в минутах</td>
    </tr>
  </tbody>
</table>
::

## Управление блокировкой камеры

Модуль управления блокировкой камеры позволяет централизованно отключать (или включать) возможность использования камеры на МУ. Параметры класса приведены в таблице 6.

::app-collapsible
---
label: "Таблица 6 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_camera_control</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>camera_enable</td>
      <td>логическое значение</td>
      <td>true</td>
      <td>Возможность запуска приложения камеры:<br>true – разрешить;<br>false – запретить</td>
    </tr>
  </tbody>
</table>
::

## Управление ПИН-кодом

Модуль позволяет принудительно задать ПИН-код блокировки. При следующей синхронизации ПИН-код будет заменен. Если на момент выполнения сессия пользователя активна, то экран будет принудительно погашен, а сессия заблокирована. Разблокировка возможна только заново установленным паролем. Параметры класса приведены в таблице 7.

::app-collapsible
---
label: "Таблица 7 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_ch_pwd</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>password</td>
      <td>строка</td>
      <td>1234</td>
      <td>ПИН-код блокировки МУ</td>
    </tr>
  </tbody>
</table>
::

## Удаление пользовательских данных

Модуль позволяет осуществить удаление пользовательских данных из МУ в двух режимах:

- **Сброс к заводским настройкам** – При выборе сброса к заводским настройкам МУ перезапустится, будет произведено полное удаление всех ранее произведенных настроек и пользовательских данных. Связь с Комплексом будет прервана и для повторного подключения необходимо будет произвести процедуру регистрации устройства.
- **Удаление пользовательских данных** – Предполагает удаление только данных в домашнем каталоге пользователя с сохранением системных настроек и подключения к Комплексу.

Параметры класса приведены в таблице 8.

::app-collapsible
---
label: "Таблица 8 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_delete_user_data</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>hard_reset_to_defaults</td>
      <td>логическое значение</td>
      <td>false</td>
      <td>Сброс устройства к заводским настройкам</td>
    </tr>
    <tr>
      <td></td>
      <td>delete_user_data</td>
      <td>логическое значение</td>
      <td>false</td>
      <td>Удаление данных в каталоге профиля пользователя</td>
    </tr>
  </tbody>
</table>
::

**Следует обратить внимание**, что удаление пользовательских данных будет происходить при каждом запуске агента Комплекса, пока класс r_mob_delete_user_data назначен устройству, а параметр delete_user_data установлен в значение true.

## Управление GPS-приемником

Модуль позволяет управлять функционированием приемника глобальной системы позиционирования и функционалом отслеживания местоположения. Параметры класса приведены в таблице 9.

::app-collapsible
---
label: "Таблица 9 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_gps_control</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>gps_enable</td>
      <td>логическое значение</td>
      <td>true</td>
      <td>Управление состоянием GPS-приемника:<br>true – приемник включен;<br>false – приемник выключен</td>
    </tr>
    <tr>
      <td>r_mob_gps_control::gps_data</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>gps_location</td>
      <td>логическое значение</td>
      <td>true</td>
      <td>Управление состоянием отслеживания местоположения:<br>true – включено;<br>false – выключено</td>
    </tr>
  </tbody>
</table>
::

**Следует отметить**, что корректная работа GPS-приемника зависит от многих факторов, основным из которых является отсутствие препятствий и/или помех прохождения сигнала.

## Управление работой GSM-модема

Модуль позволяет управлять функционированием приемо-передатчика сигнала сотовой связи. Параметры класса приведены в таблице 10.

::app-collapsible
---
label: "Таблица 10 - Параметры класса"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Имя класса</th>
      <th>Имя параметра</th>
      <th>Тип параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_gsm_control</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td>gsm_enable</td>
      <td>логическое значение</td>
      <td>true</td>
      <td>Управление состоянием GSM-модема:<br>true – включен;<br>false – выключен</td>
    </tr>
  </tbody>
</table>
::

**Следует обратить внимание**, что при отсутствии Wi-Fi-подключений выключение GSM-модема может привезти к невозможности установления связи между МУ и сервером Комплекса

## Получение информации о текущем состоянии

Получение информации о текущем состоянии МУ обеспечивается механизмом фактов. Подробно об использовании фактов описано в п. 9.3 документа "Платформа централизованного управления жизненным циклом операционных систем "РОСА Центр Управления". Руководство системного администратора. Часть 2. Эксплуатация" (шифр РСЮК.10121-09 32 02). Параметры фактов приведены в таблице 11.

::app-collapsible
---
label: "Таблица 11 - Параметры фактов"
---

#content
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Основное имя факта</th>
      <th>Имя параметра</th>
      <th>Пример значения</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r_mob_battery_capacity</td>
      <td></td>
      <td>68</td>
      <td>Заряд АКБ в процентах</td>
    </tr>
    <tr>
      <td>r_mob_battery_status</td>
      <td>pkgs_to_install</td>
      <td>Discharging</td>
      <td>АКБ в режиме разряда</td>
    </tr>
    <tr>
      <td></td>
      <td>pkgs_to_remove</td>
      <td>Charging</td>
      <td>АКБ заряжается</td>
    </tr>
    <tr>
      <td>r_mob_camera</td>
      <td>pkgs_to_update</td>
      <td>true</td>
      <td>Пользователю доступно использование камеры</td>
    </tr>
    <tr>
      <td>r_mob_gps_data</td>
      <td></td>
      <td></td>
      <td>Структурированный факт - местоположение</td>
    </tr>
    <tr>
      <td></td>
      <td>timestamp</td>
      <td>1742345601</td>
      <td>Временная отметка полученных данных в формате UNIX</td>
    </tr>
    <tr>
      <td></td>
      <td>altitude</td>
      <td>122</td>
      <td>Высота над уровнем моря</td>
    </tr>
    <tr>
      <td></td>
      <td>accuracy</td>
      <td>2.6</td>
      <td>Оценочная точность полученных координат</td>
    </tr>
    <tr>
      <td></td>
      <td>heading</td>
      <td>273</td>
      <td>Направление движения в градусах</td>
    </tr>
    <tr>
      <td></td>
      <td>latitude</td>
      <td>68.545321</td>
      <td>Широта</td>
    </tr>
    <tr>
      <td></td>
      <td>longtitude</td>
      <td>153.169764</td>
      <td>Долгота</td>
    </tr>
    <tr>
      <td></td>
      <td>osm_link</td>
      <td>https://www.openstreetmap.org/?mlat=68.545321&amp;mlon=153.169746&amp;zoom=15</td>
      <td>Сформированная ссылка просмотра местоположения на карте OpenStreetMap</td>
    </tr>
    <tr>
      <td>r_mob_gsm_connection</td>
      <td></td>
      <td></td>
      <td>Структурированный факт - данные о сотовой сети</td>
    </tr>
    <tr>
      <td></td>
      <td>cell_id</td>
      <td>0A092152</td>
      <td>Идентификатор используемой базовой станции в 16-ричном формате</td>
    </tr>
    <tr>
      <td></td>
      <td>registration_status</td>
      <td>1</td>
      <td>Код состояния регистрации в сети</td>
    </tr>
    <tr>
      <td></td>
      <td>network_mode</td>
      <td>2</td>
      <td>Режим работы сети</td>
    </tr>
    <tr>
      <td></td>
      <td>access_technology</td>
      <td>7</td>
      <td>Код используемой технологии связи</td>
    </tr>
    <tr>
      <td></td>
      <td>location_area_code</td>
      <td>87AF</td>
      <td>LAC –код местоположения базовой станции в 16-ричном формате</td>
    </tr>
    <tr>
      <td></td>
      <td>network_mode_description</td>
      <td>Enabled (status + LAC and network type)</td>
      <td>Расшифровка режима работы сети</td>
    </tr>
    <tr>
      <td></td>
      <td>access_technology_description</td>
      <td>LTE</td>
      <td>Расшифровка используемой технологии связи</td>
    </tr>
    <tr>
      <td></td>
      <td>registration_status_description</td>
      <td>Registered, home network</td>
      <td>Расшифровка состояния регистрации в сети</td>
    </tr>
    <tr>
      <td>r_mob_wifi_networks</td>
      <td></td>
      <td></td>
      <td>Структурированный факт</td>
    </tr>
    <tr>
      <td></td>
      <td>wlan0</td>
      <td>[{&quot;essid&quot;=&gt;&quot;KVA&quot;, &quot;bssid&quot;=&gt;&quot;D4:DA:21:73:2E:12&quot;, &quot;signal_level&quot;=&gt;-33}, {&quot;essid&quot;=&gt;&quot;CorpWIFI&quot;, &quot;bssid&quot;=&gt;&quot;08:43:F1:F6:35:2A&quot;, &quot;signal_level&quot;=&gt;-81}]</td>
      <td>Информация о ближайших сетях в диапазоне 2.4 ГГц. Представлена в виде хеша с отображением имени сети, аппаратного адреса и уровня сигнала</td>
    </tr>
    <tr>
      <td></td>
      <td>wlan1</td>
      <td>[{&quot;essid&quot;=&gt;&quot;KVA5&quot;, &quot;bssid&quot;=&gt;&quot;D4:DA:21:73:2E:13&quot;, &quot;signal_level&quot;=&gt;-54}, {&quot;essid&quot;=&gt;&quot;CorpWIFI&quot;, &quot;bssid&quot;=&gt;&quot;08:43:F1:F6:35:2B&quot;, &quot;signal_level&quot;=&gt;-60}]</td>
      <td>Информация о ближайших сетях в диапазоне 5 ГГц. Представлена в виде хеша с отображением имени сети, аппаратного адреса и уровня сигнала</td>
    </tr>
    <tr>
      <td>r_mob_packages</td>
      <td>list::installed::&lt;имя пакета&gt;</td>
      <td>&lt;версия пакета&gt;</td>
      <td>Информация об установленных пакетах. Имя пакета является частью имени факта, значение факта – версия установленного пакета</td>
    </tr>
  </tbody>
</table>
::