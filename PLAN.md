# План разработки MVP Markdown → PDF

## Состояние на сегодня
- Репозиторий на `master`, неслежимый артефакт: `templates/gost-template.pdf`.
- Требование по окружению: работаем только из активированного Python venv (3.11+), зависимости устанавливаем в него.
- Готовы и покрыты юнит-тестами: `walker.py`, `images.py`, `bundle.py`, `config.py`; базовый `mypy` настроен (`walker` в strict).
- Не реализованы: `pandoc_runner.py`, `cli.py`; нет сквозного пайплайна. Бандл сейчас использует только `DEFAULT_BUNDLE_METADATA`, метаданные из `config`/CLI не подмешиваются.
- Локальные проверки не запускались: в окружении нет `pytest` (`pytest: command not found`).

## Параллельные задачи (приоритетные, начать сразу)
- **Walker и структура** (Dev1, выполнено): реализован `walker.py` по `hierarchy-analysis.md`, есть минимальные тесты.
- **Резолв картинок** (Dev2): реализовать `images.py` (`strip_numeric`, `resolve_image_path`, `rewrite_images`), тесты на маппинг путей и переписывание ссылок, учесть ветки `cert/nocert`.
- **Скелет сборки бандла** (Dev3): задать интерфейс `bundle.build(order, image_resolver) -> str`, интеграционный тест на фикстурах (пока с заглушками walker/images), подготовить фронтматтер (минимум title/doctype/date) по `architecture.md`, использовать `title` из front matter файлов для структуры/оглавления, без автостраничных разрывов.
- **Конфиг** (любой свободный): `config.py` для чтения/валидации `config/project.yml` и стиля/шаблона; тесты на ошибки путей.
- **Статическая типизация** (отдельный разработчик, параллельно): базовый `mypy`-конфиг (Python 3.11, без `strict` по умолчанию), подключить проверку для новых модулей публичного API (`walker`, `images`, `bundle`, `config`, `pandoc_runner`, `cli`), точечные `strict`-секции по мере готовности; добавить запуск mypy в быстрый цикл.

## Последовательные/блокирующие шаги
- Доработать сборку бандла: прокинуть метаданные из `config`/CLI в фронтматтер, опциональную запись `bundle.md` на диск, сделать адаптер для `walker`/`images`.
- `pandoc_runner.py`: сбор аргументов, вызов Pandoc/xelatex, мок-тесты subprocess; базовая смоук-проверка рендера на фикстурах.
- `cli.py`: парсинг флагов (`--md-dir`, `--config`, `--style`, output), связывание модулей, человекочитаемые ошибки; CLI-smoke с моками runner.
- Финал MVP: установить dev-зависимости (`pytest`, `ruff` и т.п.), прогнать `ruff check . && ruff format . && pytest`, опционально реальный рендер на малом дереве, обновление DoD и краткий отчёт по результатам.

## Общие правила по задачам
- После завершения каждой задачи прогонять `ruff check .`, `ruff format .`, `pytest` (или эквивалентные проверки), фиксировать результат.
- Обновлять Definition of Done для задачи сразу по итогам выполнения.

## Прогресс (чекбоксы)
- [x] Walker и структура (`walker.py`, фикстуры, тесты)
- [x] Резолв картинок (`images.py`, переписывание ссылок, тесты)
- [x] Сборка бандла (`bundle.py`, интеграционные тесты)
- [x] Конфиг (`config.py`, валидация, тесты)
- [ ] Pandoc runner (`pandoc_runner.py`, мок-тесты, смоук рендер)
- [ ] CLI (`cli.py`, CLI-smoke с моками runner)
- [ ] Финальный прогон линтов/тестов и DoD, опционально реальный рендер
- [x] Статическая типизация (базовый mypy, строгие секции точечно)
