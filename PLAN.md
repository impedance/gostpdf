# План разработки MVP Markdown → PDF

## Состояние на сегодня
- Репозиторий на `master`, неслежимый артефакт: `templates/gost-template.pdf`.
- Требование по окружению: работаем только из активированного Python venv (3.11+), зависимости устанавливаем в него.
- Готовы и покрыты юнит-тестами: `walker.py`, `images.py`, `bundle.py`, `config.py`, `pandoc_runner.py`, `reporting.py`, вспомогательные части `pipeline.py` (валидация параметров, сбор markdown, сборка/запись бандла, вызов Pandoc, агрегация предупреждений); базовый `mypy` настроен (`walker` в strict).
- Не реализованы: `cli.py`; нет сквозного CLI и интеграционного теста пайплайна.
- Локальные проверки: `ruff format .`, `ruff check .`, `mypy .`, `python -m pytest` — все проходят в активированном `.venv`.

## Параллельные задачи (можно стартовать сразу)
- **T4 — CLI**: реализация интерфейса командной строки после готовности пайплайна.
- **T6 — Интеграция/фикстуры**: подготовка `tests/fixtures/pipeline` и интеграционного теста пайплайна с мокнутым `pandoc_runner`.

## Последовательные/блокирующие шаги
- **T4 — CLI**: `cli.main(argv=None) -> int`, argparse (`--md-dir`, `--config` default `config/project.yml`, `--style`, `--metadata key=value`, позиционный output), вывод warnings через reporting, возврат кодов. Зависит от T3/T5 (готово).
- **T6 — Интеграция/фикстуры**: `tests/fixtures/pipeline` (минимальное дерево, заглушки стиля/шаблона), интеграционный тест пайплайна с мокнутым `pandoc_runner`. Желательно после фикса интерфейсов T1/T3 (готово).
- Финал MVP: прогнать `ruff check . && ruff format . && mypy . && pytest`, опционально реальный рендер, обновление DoD и отчёт.

## Общие правила по задачам
- После завершения каждой задачи прогонять `ruff check .`, `ruff format .`, `pytest` (или эквивалентные проверки), фиксировать результат.
- Обновлять Definition of Done для задачи сразу по итогам выполнения.

## Прогресс (чекбоксы)
- [x] Walker и структура (`walker.py`, фикстуры, тесты)
- [x] Резолв картинок (`images.py`, переписывание ссылок, тесты)
- [x] Сборка бандла (базовая версия, без метаданных из config/CLI)
- [x] Конфиг (`config.py`, валидация, тесты)
- [x] T1: Бандл — метаданные/запись/переписывание через images
  [x] T2: Pandoc runner (`pandoc_runner.py`, мок-тесты, смоук рендер)
- [x] T3: Пайплайн (оркестратор, мерж override, запись bundle, вызов runner)
  - [x] Подзадача 1: Валидация/мердж параметров
  - [x] Обвязка walker (сбор Markdown и предупреждений)
  - [x] Обвязка bundle (сбор и запись бандла)
  - [x] Обвязка pandoc_runner (вызов рендера PDF)
  - [x] Агрегация результатов/предупреждений
- [ ] T4: CLI (аргументы, вывод warnings, коды выхода)
- [x] T5: Reporting helper (форматирование предупреждений)
- [x] T6: Интеграция/фикстуры (pipeline fixture + интеграционный тест)
- [ ] Финальный прогон линтов/тестов, DoD, опционально реальный рендер
- [x] Статическая типизация (базовый mypy, строгие секции точечно)
